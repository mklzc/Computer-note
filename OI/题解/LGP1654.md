# P1654 OSU!

## 思路

考虑 $DP$ 转移，设 $F[i]$ 表示长度为 $i$ 序列的期望分数。

得到如下转移：

$F[i]=(F[i-1]-A[i-1]+A[i])p_i+F[i-1](1-p_i)$

其中 $A[i]$ 的意义是：以 $i$ 位 $1$ 结尾极长连续段的立方贡献的分数。

再设 $B[i]$ 为以 $i$ 位 $1$ 结尾极长连续段的平方贡献的分数，$C[i]$ 为以 $i$ 位 $1$ 结尾极长连续段贡献的分数。

可以发现：$A[i]$ 可以由 $B[i]$ 和 $C[i]$ 转移得到：$A[i]=A[i-1]+3B[i-1]+3C[i-1]+1$

上式是因为：$(x+1)^3=x^3+3x^2+3x+1$

同理: $B[i]=B[i-1]+2A[i-1]+1, C[i]=C[i-1]+1$