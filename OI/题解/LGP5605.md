# LGP5605 小A与两位神仙

Link: [小A与两位神仙](https://www.luogu.com.cn/problem/P5605)

## 思路

观察模数 $p$ 的性质：为奇素数的幂，即有原根（设为 $g$）。

又 $x, y$ 与 $p$ 互质，$x, y$ 可以被唯一表示成 $g^b$ 和 $g^c$ 的形式。

于是原方程化为 $g^{ab}\equiv g^c\pmod p$

根据指标的相关性质，得到 $ab\equiv c\pmod{\varphi(p)}$

由裴蜀定理可知，该方程当且仅当 $(b, \varphi(p))\mid (c, \varphi(p))$ （因为 $(b, \varphi(p))\mid \varphi(p)$ 且 $(b, \varphi(p))\mid c$）。

有如下结论：$\displaystyle \gcd(b, \varphi(p))=\frac{\varphi(p)}{\mathrm{ord_p}(g^b)}$ 。

考虑证明。

考察集合 $\{g^{b}, g^{2b}, g^{3b}\dots\}$ 的性质。

在一个大小为 $\varphi(p)$ 的环上，每次跳 $b$ 步，$\displaystyle \frac{\varphi(p)}{\gcd(b, \varphi(p))}$ 步后会回到原点。

又该集合的大小恰好就是 $g^b$ 的阶，于是 $\displaystyle \mathrm{ord_p}(g^b)=\frac{\varphi(p)}{\gcd(\varphi(p), b)}$

变换一下，结论得证。

于是问题转化为判断：$\mathrm{ord(y)}\mid \mathrm{ord(x)}$ 。

使用 $pollard-prho$ 快速求阶即可。

具体地，确定一个变量 $d$ ，赋予初值 $\varphi(p)$ 。

考虑到性质 ：$x^e\equiv 1\pmod p\to x^{de}\equiv 1\pmod p$ 。

每次将 $a$ 除以一个它自身的某一个因子，直到 $x^a\not \equiv 1\pmod p$ 或 $a$ 为素数时停止。

递归即可。
